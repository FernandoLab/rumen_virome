---
title: "Map Reads to ORFs"
output:
  html_document:
    keep_md: true
---

Make bowtie databases for all datasets.

```{r, engine='bash'}
mkdir vmg_orfs_bowtie
bowtie2-build vmg.orfs_nt.filter.fasta vmg_orfs_bowtie/vmg_orfs_bowtie_db

mkdir bmg_orfs_bowtie
bowtie2-build bmg.orfs_nt.filter.fasta bmg_orfs_bowtie/bmg_orfs_bowtie_db

mkdir vmg_illumina_orfs_bowtie
bowtie2-build vmg.illumina.orfs_nt.filter.fasta vmg_illumina_orfs_bowtie/vmg_illumina_orfs_bowtie_db
```	

Align viral metagenome reads to nt ORFs.

```{r, engine='bash'}
for f in viral_qc/*finalQC.fastq
do
  filename=$(basename "$f")
  filename="${filename%_*}"
  bowtie2 -U $f --end-to-end --sensitive -x vmg_orfs_bowtie/vmg_orfs_bowtie_db -S vmg_orfs_bowtie/$filename.psl --un vmg_orfs_bowtie/$filename.unaligned.txt --al vmg_orfs_bowtie/$filename.aligned.txt
done

```

Align microbial metagenome reads to nt ORFs.

```{r, engine='bash'}	
for f in microbial_qc/*finalQC.fastq
do
  filename=$(basename "$f")
  filename="${filename%_*}"
  bowtie2 -U $f --end-to-end --sensitive -x bmg_orfs_bowtie/bmg_orfs_bowtie_db -S bmg_orfs_bowtie/$filename.psl --un bmg_orfs_bowtie/$filename.unaligned.txt --al bmg_orfs_bowtie/$filename.aligned.txt 
done
```
	
Align deep viral metagenome reads to nt ORFs.

```{r, engine='bash'}
for f in deep_viral_qc/*illumina_finalQC.fastq
do
  filename=$(basename "$f")
  filename="${filename%_*}"
  bowtie2 -U $f --end-to-end --sensitive -x vmg_illumina_orfs_bowtie/vmg_illumina_orfs_bowtie_db -S vmg_illumina_orfs_bowtie/$filename.psl --un vmg_illumina_orfs_bowtie/$filename.unaligned.txt --al vmg_illumina_orfs_bowtie/$filename.aligned.txt 
done
```


